package com.example.emailsender;import android.app.ProgressDialog;import android.content.Context;import android.content.ContextWrapper;import android.graphics.Bitmap;import android.os.AsyncTask;import android.widget.Toast;import java.io.ByteArrayOutputStream;import java.io.File;import java.io.IOException;import java.util.Properties;import javax.activation.DataHandler;import javax.mail.AuthenticationFailedException;import javax.mail.BodyPart;import javax.mail.Message;import javax.mail.MessagingException;import javax.mail.Multipart;import javax.mail.PasswordAuthentication;import javax.mail.Session;import javax.mail.Transport;import javax.mail.internet.InternetAddress;import javax.mail.internet.MimeBodyPart;import javax.mail.internet.MimeMessage;import javax.mail.internet.MimeMultipart;import javax.mail.util.ByteArrayDataSource;public class SendMailTask extends AsyncTask{    private Context context;    private Session session;    private String From;    private String To;    private String subject;    private String message;    private String password;    private ProgressDialog progressDialog;    public SendMailTask(Context context,String From, String TO, String subject, String message, String Password ){        this.context = context;        this.From =From;        this.To = TO;        this.subject = subject;        this.message = message;        password = Password;    }    @Override    protected Object doInBackground(Object[] objects) {        Properties props = new Properties();        props.put("mail.smtp.host", "smtp.gmail.com");        props.put("mail.smtp.socketFactory.port", "465");        props.put("mail.smtp.socketFactory.class", "javax.net.ssl.SSLSocketFactory");        props.put("mail.smtp.auth", "true");        props.put("mail.smtp.port", "465");        props.put("mail.smtp.socketFactory.fallback", "false");        props.setProperty("mail.smtp.quitwait", "false");        session = Session.getDefaultInstance(props, new javax.mail.Authenticator() {            protected PasswordAuthentication getPasswordAuthentication() {                return new PasswordAuthentication(From,password );            }        });        try {            MimeMessage mm = new MimeMessage(session);            mm.setFrom(new InternetAddress(From));            mm.addRecipient(Message.RecipientType.TO, new InternetAddress(To));            mm.setSubject(subject);            mm.setText(message);            Transport.send(mm);        } catch (AuthenticationFailedException e){            Toast.makeText(context, "There is an error in either email id or google app password. Please check them carefully ", Toast.LENGTH_LONG).show();        } catch (MessagingException e) {            e.printStackTrace();            Toast.makeText(context, "Some error occurred while sending mail", Toast.LENGTH_SHORT).show();        }        return null;    }    @Override    protected void onPostExecute(Object o) {        super.onPostExecute(o);//        progressDialog.dismiss();        Toast.makeText(context,"Message Sent",Toast.LENGTH_LONG).show();    }    @Override    protected void onPreExecute() {        super.onPreExecute();//        progressDialog = ProgressDialog.show(context,"Sending message","Please wait...",false,false);    }}